## Лабораторная работа номер 5(Балансировка нагрузки, Лабораторная работа №4 с обвесами)
##Задание
Имеется 2 сервера: web1 и web2. На каждый из них следует установить nginx. Еще 2 сервера: haproxy1 и haproxy2, тут уже необходимо настроить отказоустойчивую связку HAProxy и keepalive. C помощью keepalive также настраиваем VIP как по скинутой схеме:

На серверах web1/2 NGINX работает на портах 8080, каждому серверу нужна кастомная  страница, которая поможет понять, на каком из них мы находимся. Для haproxy NGINX нужен для балансировки серверов в режиме round-robin. Тут же настраиваем ожидание ответов от web1 и web2 не более 2 секунд. Также необходимо написать ansible сценарий (playbook), который будет устанавливать и настраивать ПО серверов. Порты сделать, кстати, как переменные(это важно)
##Что нам понадобится для выполнения работы
Ну для начала неплохо было бы заиметь кастомный CentOS с отключенными SELinux и firewall
	

В этой ветке можно найти ansible-файл, который выполняет следующие функции: 

Устанавливает на серверах web1 web2 nginx
На серверах haproxy1, haproxy2 устанавливает и настраивает отказоустойчивую связку HAProxy+Keepalived
На серверах web1, web2 Nginx работает по порту 8080 и отдает кастомную страницу
На серверах с HAProxy ПО обеспечивает балансировку нагрузки серверов web1 и web2 в режиме round-robin.

## Для поднятия машин:

Скопировать репозиторий
Потом зайти через терминал в папку которую скопировали
Открываем Vagrantfile
Изменяем 46-ю строку ssh_pub_key = File.readlines("/home/sirius/.ssh/id_rsa.pub").first.strip
Выполняем команду vagrant up
Далее прописываем в консоли ansible-playbook game.yml
Проверить работоспособность можно перейдя по адресу http://192.168.11.100/

## Работа Балансировки
<a href="https://ibb.co/xD5Smnr"><img src="https://i.ibb.co/FK7bsQd/07-04.png" alt="07-04" border="0"></a>
<a href="https://ibb.co/gJDdD8V"><img src="https://i.ibb.co/FzBXB1V/07-04-2.png" alt="07-04-2" border="0"></a>

## Отказоустойчивость:

Суть отказоустойчивости в следующих действиях: c помощью команды "ip a" узнаем, на какую виртуальную машину назначен адрес 192.168.11.100. Выключаем. Работа не изменилась,значит все работает корректно.

### Отключаем:

<img src="https://i.ibb.co/179gtHm/Screenshot-from-2022-04-06-21-44-25.png" >

### Смотрим ip и проверяем работоспособность:

<img src="https://i.ibb.co/HYT1PXD/Screenshot-from-2022-04-06-21-52-55.png" >

<img src="https://camo.githubusercontent.com/66d0e077c38e3ff231b928e5715934176f9c414ffa0092799dfa35315c3761f0/68747470733a2f2f692e6962622e636f2f4e724335636e532f77656262312e6a7067" >

<img src="https://camo.githubusercontent.com/3e5a3bd939b549d3fc24977aaa15cd1bded7c080eb2ad60ba93a29aa258ffbea/68747470733a2f2f692e6962622e636f2f764c7a515167642f77656262322e6a7067" >

##Это все, что останется после меня. Это все, что возьму я с собой
